name: Release and Docs
on:
  push:
    tags:
      - 'v*' # v1.0.2 같은 태그가 푸시될 때 실행

jobs:
  deploy:
    # ===========================================
    # [1] General Ubuntu 환경에서 실행
    # ===========================================
    runs-on: ubuntu-latest

    permissions:
      contents: write  # gh-pages 브랜치에 푸시하기 위해 필수
      pages: write     # GitHub Pages 설정을 위해 권한 부여
      id-token: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 태그 기반 버전을 위해 필수!

      - name: Install uv
        uses: astral-sh/setup-uv@v5
        with:
          enable-cache: true

      - name: Package Build
        run: uv build

      # - name: Publish Package
      #   # Secrets에 REPO_URL, REPO_USERNAME, REPO_PASSWORD를 등록.
      #   env:
      #     UV_PUBLISH_URL: ${{ secrets.REPO_URL }}
      #     UV_PUBLISH_USERNAME: ${{ secrets.REPO_USERNAME }}
      #     UV_PUBLISH_PASSWORD: ${{ secrets.REPO_PASSWORD }}
      #   run: uv publish

      - name: Deploy Docs
        run: uv run mkdocs gh-deploy --force
        # run: |
        #   git config --global user.name "github-actions[bot]"
        #   git config --global user.email "github-actions[bot]@users.noreply.github.com"
        #   uv run mkdocs gh-deploy --force

    # ===========================================
    # [2] Self-hosted 환경에서 실행 (Windows)
    # ===========================================
    # runs-on: [self-hosted, windows]

    # permissions:
    #   contents: write  # gh-pages 브랜치에 푸시하기 위해 필수
    #   pages: write     # GitHub Pages 설정을 위해 권한 부여
    #   id-token: write

    # steps:
    #   - name: Checkout code
    #     uses: actions/checkout@v4
    #     with:
    #       fetch-depth: 0  # 태그 기반 버전을 위해 필수!

    #   - name: Install uv
    #     uses: astral-sh/setup-uv@v5

    #   - name: Package Build
    #     run: uv build

    #   # - name: Publish Package
    #   #   # Secrets에 REPO_URL, REPO_USERNAME, REPO_PASSWORD를 등록.
    #   #   shell: pwsh
    #   #   env:
    #   #     UV_PUBLISH_URL: ${{ secrets.REPO_URL }}
    #   #     UV_PUBLISH_USERNAME: ${{ secrets.REPO_USERNAME }}
    #   #     UV_PUBLISH_PASSWORD: ${{ secrets.REPO_PASSWORD }}
    #   #   run: uv publish

    #   - name: Deploy Docs
    #     shell: pwsh
    #     run: uv run mkdocs gh-deploy --force
    #     # run: |
    #     #   git config --global user.name "github-actions[bot]"
    #     #   git config --global user.email "github-actions[bot]@users.noreply.github.com"
    #     #   uv run mkdocs gh-deploy --force